var RespTblUtil = {
	insertRow: function(editor, offset) {
		var cell = editor.selection.getNode();
		//console.log(editor.selection.getNode());
		var row = cell.parentNode;
		var table = row.offsetParent;		
		
		var rowc = ($(table).hasClass("gen2col"))?"col2-table-row":"col2-table-halfRow";
		var col1c = ($(table).hasClass("gen2col"))?"field":"half-col";
		var col2c = ($(table).hasClass("gen2col"))?"detail":"half-col";
		
		var rowhtm='	<div class="'+rowc+'">';
		rowhtm+='		<div class="table-col '+col1c+'">&nbsp;</div>';
		rowhtm+='		<div class="table-col '+col2c+'">&nbsp;</div>';
		rowhtm+='	</div>';
		if (offset==1) $(row).after(rowhtm);
		else if (offset==0) $(row).before(rowhtm);
	},
	insertRowAbove : function(editor) {
		RespTblUtil.insertRow(editor, 0);
	},
	insertRowBelow : function(editor) {
		RespTblUtil.insertRow(editor, 1);
	},
	deleteRow : function(editor) {
		var cell = editor.selection.getNode();
		$(cell).closest(".col2-table-row").remove();
	},
	deleteTable : function(editor) {
		var cell = editor.selection.getNode();
		var table = cell.offsetParent;
		$(cell).closest(".jresptbl").remove();
	}
};


tinymce.PluginManager.add('resptbl', function(editor, url) {
    editor.addButton('resptbl', {
		type: 'menubutton',
		text: '',   //without text label
		//icon: 'table',    //use original icon
		image: url + '/resptbl.png',
		tooltip: 'Responsive Tbl',     //tooltip, if you want
		menu: [
			//{ text: 'Table Property', onclick:function() { TblUtil.tableProperty(editor); } },
			{ text: 'Insert Responsive Table', onclick:function() { 
				editor.windowManager.open({
					title: "Insert responsive 2 column table",
					//url: '/cmsadmin/TinyMce/TableDialog',
					body: [
						{type: 'textbox', name: 'rows', label: 'Rows:', value:'2'},
						{type: 'listbox', name: 'tblc', label: 'Class:', values : [
							{ text: 'General', value: 'gen2col' }, { text: 'Half 50%', value: 'half2col' }
						], value : 'gen' /*Sets the default*/ },
					],
					onsubmit: function(e) {
						// Insert content when the window form is submitted
						var tblc = e.data.tblc;
						var htm='<div class="jresptbl '+tblc+'">';
						var r = parseInt(e.data.rows);
						for (var i=0; i<r; i++) {
							var rowc = (tblc=="gen2col")?"col2-table-row":"col2-table-halfRow";
							var col1c = (tblc=="gen2col")?"field":"half-col";
							var col2c = (tblc=="gen2col")?"detail":"half-col";
							htm+='	<div class="'+rowc+'">';
							htm+='		<div class="table-col '+col1c+'">&nbsp;</div>';
							htm+='		<div class="table-col '+col2c+'">&nbsp;</div>';
							htm+='	</div>';
						}
						htm+='</div>';
						editor.insertContent(htm);
					},
					width: 400,
					height: 120,
				});
			} },
			{ text: 'Insert Row Above', onclick:function() { RespTblUtil.insertRow(editor, 0); } },
			{ text: 'Insert Row Below', onclick:function() { RespTblUtil.insertRow(editor, 1); } },
			{ text: 'Delete Row', onclick:function() { RespTblUtil.deleteRow(editor); } },
			{ text: 'Delete Table', onclick:function() { RespTblUtil.deleteTable(editor); } },
		]
	});		
});